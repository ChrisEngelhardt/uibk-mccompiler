<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MC Compiler: mC Compiler Specification</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MC Compiler
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">mC Compiler Specification </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document describes the mC compiler as well as the mC language itself along with some requirements. Like a regular compiler the mC compiler is divided into 3 main parts: front-end, back-end, and a core in-between.</p>
<p>The front-end's task is to validate a given input using syntactic and semantic checks. The syntactic checking is done by the <em>parser</em>, which, on success, generates an abstract syntax tree (AST). This tree data structure is mainly used for semantic checking, although transformations can also be applied to it. Moving on, the AST is translated to the compiler's intermediate representation (IR) and passed to the core. Invalid inputs cause errors to be reported.</p>
<p>The core provides infrastructure for running analyses and transformations on the IR. These analyses and transformations are commonly used for optimisation. Additional data structures, like the control flow graph (CFG), are utilised for this phase. Next, the (optimised) IR is passed to the back-end.</p>
<p>The back-end translates the platform <em>independent</em> IR code to platform <em>dependent</em> assembly code. An assembler converts this code to <em>object code</em>, which is finally crafted into an executable by the linker. For these last two steps, GCC is used — referred to as <em>back-end compiler</em> in this context.</p>
<p>The mC compiler is implemented using modern C (or C++) adhering to the C11 (or C++17) standard.</p>
<h2>Milestones</h2>
<ol type="1">
<li><b>Parser</b><ul>
<li>Inputs are accepted / rejected correctly (syntax only).</li>
<li>Syntactically invalid inputs result in a meaningful error message containing the corresponding source location.</li>
<li>An AST is constructed for valid inputs.</li>
<li>The obtained AST can be printed in the DOT format (see <code>mc_ast_to_dot</code>).</li>
</ul>
</li>
<li><b>Semantic checks</b><ul>
<li>The compiler rejects semantically wrong inputs.</li>
<li>Invalid inputs trigger a meaningful error message including source location information.</li>
<li>Type checking can be traced (see <code>mc_type_check_trace</code>).</li>
<li>Symbol tables can be viewed (see <code>mc_symbol_table</code>).</li>
</ul>
</li>
<li><b>Control flow graph</b><ul>
<li>Valid inputs are converted to IR.</li>
<li>The IR can be printed (see <code>mc_ir</code>).</li>
<li>The CFG is generated and can be printed in the DOT format (see <code>mc_cfg_to_dot</code>).</li>
</ul>
</li>
<li><b>Back-end</b><ul>
<li>Valid inputs are converted to IR and then to assembly code.</li>
<li>The assembly code can be printed (see <code>mc_asm</code>).</li>
<li>GCC is invoked to create the final executable.</li>
</ul>
</li>
<li><b>Build Infrastructure</b><ul>
<li>Your code builds and tests successfully on my evaluation system.</li>
</ul>
</li>
</ol>
<h2>mC Language</h2>
<p>This section defines <em>mC</em> — a simple, C-like language. The semantics of mC are identical to C unless specified otherwise.</p>
<h3>Grammar</h3>
<p>The next segment defines the grammar of mC using this notation:</p>
<ul>
<li><code>#</code> starts a single line comment</li>
<li><code>,</code> indicates concatenation</li>
<li><code>|</code> indicates alternation</li>
<li><code>( )</code> indicates grouping</li>
<li><code>[ ]</code> indicates optional parts (0 or 1)</li>
<li><code>{ }</code> indicates repetition (1 or more)</li>
<li><code>[ ]</code> and <code>{ }</code> can be combined to build <em>0 or more</em> repetition</li>
<li><code>" "</code> indicates a terminal string</li>
<li><code>/ /</code> indicates a <a href="https://www.regular-expressions.info/">RegEx</a></li>
</ul>
<div class="fragment"><div class="line"># Primitives</div><div class="line"></div><div class="line">alpha            = /[a-zA-Z_]/</div><div class="line"></div><div class="line">alpha_num        = /[a-zA-Z0-9_]/</div><div class="line"></div><div class="line">digit            = /[0-9]/</div><div class="line"></div><div class="line">identifier       = alpha , [ { alpha_num } ]</div><div class="line"></div><div class="line"></div><div class="line"># Operators</div><div class="line"></div><div class="line">unary_op         = &quot;-&quot; | &quot;!&quot;</div><div class="line"></div><div class="line">binary_op        = &quot;+&quot;  | &quot;-&quot; | &quot;*&quot; | &quot;/&quot;</div><div class="line">                 | &quot;&lt;&quot;  | &quot;&gt;&quot; | &quot;&lt;=&quot; | &quot;&gt;=&quot;</div><div class="line">                 | &quot;&amp;&amp;&quot; | &quot;||&quot;</div><div class="line">                 | &quot;==&quot; | &quot;!=&quot;</div><div class="line"></div><div class="line"></div><div class="line"># Types</div><div class="line"></div><div class="line">type             = &quot;bool&quot; | &quot;int&quot; | &quot;float&quot; | &quot;string&quot;</div><div class="line"></div><div class="line"></div><div class="line"># Literals</div><div class="line"></div><div class="line">literal          = bool_literal</div><div class="line">                 | int_literal</div><div class="line">                 | float_literal</div><div class="line">                 | string_literal</div><div class="line"></div><div class="line">bool_literal     = &quot;true&quot; | &quot;false&quot;</div><div class="line"></div><div class="line">int_literal      = { digit }</div><div class="line"></div><div class="line">float_literal    = { digit } , &quot;.&quot; , { digit }</div><div class="line"></div><div class="line">string_literal   = /&quot;[^&quot;]*&quot;/</div><div class="line"></div><div class="line"></div><div class="line"># Declarations / Assignments</div><div class="line"></div><div class="line">declaration      = type , [ &quot;[&quot; , int_literal , &quot;]&quot; ] , identifier</div><div class="line"></div><div class="line">assignment       = identifier , [ &quot;[&quot; , expression , &quot;]&quot; ] , &quot;=&quot; , expression</div><div class="line"></div><div class="line"></div><div class="line"># Expressions</div><div class="line"></div><div class="line">expression       = literal</div><div class="line">                 | identifier , [ &quot;[&quot; , expression , &quot;]&quot; ]</div><div class="line">                 | call_expr</div><div class="line">                 | unary_op , expression</div><div class="line">                 | expression , binary_op , expression</div><div class="line">                 | &quot;(&quot; , expression , &quot;)&quot;</div><div class="line"></div><div class="line"></div><div class="line"># Statements</div><div class="line"></div><div class="line">statement        = if_stmt</div><div class="line">                 | while_stmt</div><div class="line">                 | ret_stmt</div><div class="line">                 | declaration , &quot;;&quot;</div><div class="line">                 | assignment  , &quot;;&quot;</div><div class="line">                 | expression  , &quot;;&quot;</div><div class="line">                 | compound_stmt</div><div class="line"></div><div class="line">if_stmt          = &quot;if&quot; , &quot;(&quot; , expression , &quot;)&quot; , statement , [ &quot;else&quot; , statement ]</div><div class="line"></div><div class="line">while_stmt       = &quot;while&quot; , &quot;(&quot; , expression , &quot;)&quot; , statement</div><div class="line"></div><div class="line">ret_stmt         = &quot;return&quot; , [ expression ] , &quot;;&quot;</div><div class="line"></div><div class="line">compound_stmt    = &quot;{&quot; , [ { statement } ] , &quot;}&quot;</div><div class="line"></div><div class="line"></div><div class="line"># Function Definitions / Calls</div><div class="line"></div><div class="line">function_def     = ( &quot;void&quot; | type ) , identifier , &quot;(&quot; , [ parameters ] , &quot;)&quot; , compound_stmt</div><div class="line"></div><div class="line">parameters       = declaration , [ { &quot;,&quot; , declaration } ]</div><div class="line"></div><div class="line">call_expr        = identifier , &quot;(&quot; , [ arguments ] , &quot;)&quot;</div><div class="line"></div><div class="line">arguments        = expression , [ { &quot;,&quot; expression } ]</div><div class="line"></div><div class="line"></div><div class="line"># Program</div><div class="line"></div><div class="line">program          = [ { function_def } ]</div></div><!-- fragment --><h3>Comments</h3>
<p>mC supports only <em>C-style</em> comments, starting with <code>/*</code> and ending with <code>*/</code>. Like in C, they can span across multiple lines. Comments are discarded by the parser; however, line breaks are taken into account for line numbering.</p>
<h3>Size Limitations</h3>
<p><code>long</code> and <code>double</code> are used in the compiler to store mC's <code>int</code> and <code>float</code> literals, respectively. It is assumed that both types are big and precise enough to store the corresponding literal.</p>
<p>Furthermore, it is assumed that arrays and strings are at most <code>LONG_MAX</code> elements long.</p>
<h3>Special Semantics</h3>
<h4>Boolean</h4>
<p><code>bool</code> is considered a first-class citizen, distinct from <code>int</code>.</p>
<p>The operators <code>!</code>, <code>&amp;&amp;</code>, and <code>||</code> can only be used with Booleans. Short-circuit evaluation is <em>not</em> supported.</p>
<h4>Strings</h4>
<p>Strings are immutable and do not support any operation (e.g. concatenation). Like comments, strings can span across multiple lines. Newlines and indentation whitespaces are part of the string, when dealing with multiline strings. Escape sequences are <em>not</em> supported.</p>
<p>Their sole purpose is to be used with the built-in <code>print</code> function (see below).</p>
<h4>Arrays</h4>
<p>Only one dimensional arrays with static size are supported. The size must be stated during declaration and is part of the type. The following statement declares an array of integers with 42 elements. </p><pre class="fragment">int[42] my_array;
</pre><p>We do not support <em>any</em> operations on whole arrays. For example, the following code is <em>invalid</em>: </p><pre class="fragment">int[10] a;
int[10] b;
int[10] c;

c = a + b;    /* not supported */
</pre><p>This needs to be rewritten as a loop in order to work: </p><pre class="fragment">int i;
i = 0;
while (i &lt; 10) {
    c[i] = a[i] + b[i];
    i = i + 1;
}
</pre><p>Even further, one cannot assign to a variable of array type. </p><pre class="fragment">c = a;    /* not supported, even though both are of type int[10] */
</pre><h4>Call by Value / Call by Reference</h4>
<p><code>bool</code>, <code>int</code>, and <code>float</code> are passed directly (by value). Strings and arrays are passed via pointers internally (by reference).</p>
<p>Modifications made to an array inside a function are visible outside of that function.</p>
<h4>Type Conversion</h4>
<p>There are <em>no</em> type conversion, neither implicit nor explicit.</p>
<p>An expression used as a condition (for <code>if</code> or <code>while</code>) is expected to be of type <code>bool</code>.</p>
<p><em>Note:</em> If the need for explicit type conversion arises, additional built-ins will be added for this purpose.</p>
<h4>Entry Point</h4>
<p>The top-level grammar rule is <code>program</code> which simply consists of 0 or more function definitions.</p>
<p>While the parser happily accepts empty source files, a semantic check enforces the presence of a function named <code>main</code>. This function takes no arguments and returns an <code>int</code>.</p>
<p>On success, an mC program returns <code>0</code>.</p>
<h4>Declaration, Definition, and Initialization</h4>
<p><code>declaration</code> is used to declare variables which can then be initialised with <code>assignment</code>. Splitting declaration and initialisation simplifies the creation of symbol tables.</p>
<p>Functions are always declared by their definition. Forward declarations are therefore <em>not</em> supported. Contrary to C, it is possible to call a function before it has been declared (in case of mC defined).</p>
<h4>Empty Parameter List</h4>
<p>In C, the parameter list of a function taking no arguments is written as <code>(void)</code>. mC, in this case, just uses an empty parameter list <code>()</code>.</p>
<h4>Dangling Else</h4>
<p>A <a href="https://en.wikipedia.org/wiki/Dangling_else"><em>dangling else</em></a> belongs to the innermost <code>if</code>. The following mC code snippets are semantically equivalent: </p><pre class="fragment">if (c1)              |        if (c1) {
    if (c2)          |            if (c2) {
        f2();        |                f2();
    else             |            } else {
        f3();        |                f3();
                     |            }
                     |        }
</pre><h3>Built-in Functions</h3>
<p>The following built-in functions are provided by the compiler for I/O operations:</p>
<ul>
<li><code>void print(string)</code> outputs the given string to <code>stdout</code></li>
<li><code>void <a class="el" href="../../d4/dfd/stdmclib_8c.html#a7a66934676ef64ae9090f5050c96e75a">print_nl()</a></code> outputs the new-line character (<code>\n</code>) to <code>stdout</code></li>
<li><code>void print_int(int)</code> outputs the given integer to <code>stdout</code></li>
<li><code>void <a class="el" href="../../d4/dfd/stdmclib_8c.html#ae263043922f2154fed0757f8c9af61bb">print_float(float)</a></code> outputs the given float to <code>stdout</code></li>
<li><code>int <a class="el" href="../../d4/dfd/stdmclib_8c.html#a03c1ec58ad8b0bbdc7e3e056ae0664c4">read_int()</a></code> reads an integer from <code>stdin</code></li>
<li><code>float <a class="el" href="../../d4/dfd/stdmclib_8c.html#a12da13be022b6463c7577dc3df85c05c">read_float()</a></code> reads a float from <code>stdin</code></li>
</ul>
<h2>mC Compiler</h2>
<p>The mC compiler is implemented as a library. It can be used either programmatically or via the provided command-line applications.</p>
<p>The focus lies on a clean and modular implementation as well as a straight forward architecture, rather than raw performance. For example, each semantic check may traverse the AST in isolation.</p>
<p>The compiler guarantees the following:</p>
<ul>
<li>Exported symbols are prefixed with <code>mcc_</code>.</li>
<li>It is thread-safe.</li>
<li>No memory is leaked — even in error cases.</li>
<li>Functions do not interact directly with <code>stdin</code>, <code>stdout</code>, or <code>stderr</code>.</li>
<li>No function terminates the application on correct usage.</li>
</ul>
<h3>Logging</h3>
<p>Logging infrastructure may be present; however, all log output is disabled by default. The log level can be set with the environment variable <code>MCC_LOG_LEVEL</code>. </p><pre class="fragment">0 = no logging
1 = normal logging (info)
2 = verbose logging (debug)
</pre><p>The output destination can be set with <code>MCC_LOG_FILE</code> and defaults to <code>stdout</code>.</p>
<p>Log messages do not overlap on multi-threaded execution.</p>
<h3>Parser</h3>
<p>The parser reads the given input and, if it conforms syntactically to an mC program, constructs the corresponding AST. An invalid input is rejected, resulting in a meaningful error message. For instance: </p><pre class="fragment">foo.mc:3:8: error: unexpected '{', expected ‘(’
</pre><p>It is recommended to closely follow the error message format of other compilers. This allows for better IDE integration.</p>
<p>Displaying the offending source code along with the error message is helpful, but not required.</p>
<p>Parsing may stop on the first error. Error recovery is optional.</p>
<p>The parser component may be generated by tools like <code>flex</code> and <code>bison</code>, or similar. Although, you are encouraged to implement a recursive descent or combinator parser instead. Nevertheless, pay attention to operator precedence.</p>
<p>Note that partial mC programs, like an expression or statement, are not valid inputs to the main <em>parse</em> function. The library may provide additional functions for parsing single expressions or statements.</p>
<h3>Abstract Syntax Tree</h3>
<p>The AST data structure itself is <em>not</em> specified.</p>
<p>Consider using the visitor pattern for tree traversals.</p>
<p>Given this example input:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> fib(<span class="keywordtype">int</span> n)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (n &lt; 2) <span class="keywordflow">return</span> n;</div><div class="line">    <span class="keywordflow">return</span> fib(n - 1) + fib(n - 2);</div><div class="line">}</div></div><!-- fragment --><p>The visualisation of the AST for the <code>fib</code> function could look like this:</p>
<div class="image">
<img src="../../images/fib_ast.png" alt="`fib` AST example"/>
</div>
<h3>Semantic Checks</h3>
<p>As the parser only does syntactic checking, additional semantic checks are implemented:</p>
<ul>
<li>Checking for uses of undeclared variables</li>
<li>Checking for multiple declarations of variables with the same name in the same scope</li>
<li>Checking for multiple definitions of functions with the same name</li>
<li>Checking for calls to unknown functions</li>
<li>Checking for presence of <code>main</code> and correct signature</li>
<li>Checking that all execution paths of a non-void function return a value</li>
<li>Type checking (remember, neither implicit nor explicit type conversions)<ul>
<li>Includes checking operations on arrays</li>
<li>Includes checking arguments and return types for call expressions</li>
</ul>
</li>
</ul>
<p>In addition to the AST, <em>symbol tables</em> are created and used for semantic checking. Be sure to correctly model <a href="https://en.wikipedia.org/wiki/Variable_shadowing"><em>shadowing</em></a>.</p>
<h3>Intermediate Representation</h3>
<p>As IR, a low-level <a href="https://en.wikipedia.org/wiki/Three-address_code">three-address code (TAC)</a> is used. The instruction set of this code is <em>not</em> specified.</p>
<p>The compiler's core is independent from the front- and back-end.</p>
<h3>Control Flow Graph</h3>
<p>A control flow graph data structure is present and can be constructed for a given IR program. This graph is commonly used by analyses for extracting structural information crucial for transformation steps.</p>
<p>It is recommended to also provide a visitor mechanism for this graph.</p>
<p>Like the AST, it can be visualised. The example below is taken from <a href="http://www.csd.uwo.ca/~moreno/CS447/Lectures/CodeOptimization.html/node6.html">Marc Moreno Maza</a>.</p>
<p>Given this example IR:</p>
<div class="fragment"><div class="line">    s = 0</div><div class="line">    i = 0</div><div class="line">    n = 10</div><div class="line">L1: t1 = a - b</div><div class="line">    ifz t1 goto L2</div><div class="line">    t2 = i * 4</div><div class="line">    s  = s + t2</div><div class="line">    goto L3</div><div class="line">L2: s = s + i</div><div class="line">L3: i  = i + 1</div><div class="line">    t3 = n - i</div><div class="line">    ifnz t3 goto L1</div><div class="line">    t4 = a - b</div></div><!-- fragment --><p>The visualisation of the corresponding CFG could look like this:</p>
<div class="image">
<img src="../../images/cfg.png" alt="CFG Example"/>
</div>
<h3>Assembly Code Generation</h3>
<p>The mC compiler targets x86 and uses GCC as back-end compiler. On an x86_64 system, GCC multi-lib support must be available and the flag <code>-m32</code> is passed to the compiler.</p>
<p>The code generated by the back-end is compiled with the <a href="https://en.wikipedia.org/wiki/GNU_Assembler">GNU Assembler</a> (by GCC). Pay special attention to floating point and integer handling.</p>
<p>Use <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cdecl">cdecl calling convention</a>. It is paramount to correctly implement the calling convention, otherwise the stack may get corrupted during function calls and returns.</p>
<h2>Applications</h2>
<p>Apart from the main compiler executable <code>mcc</code>, additional auxiliary executables are provided. These executables aid the development process and are used for evaluation.</p>
<p>The applications are commonly defined by their usage information. Composing them with other command-line tools, like <code>dot</code>, is a core feature.</p>
<p>The exact output format is not specified in all cases. However, details should <em>not</em> be omitted — like simplifying the AST.</p>
<p>All applications exit with code <code>EXIT_SUCCESS</code> <em>iff</em> they succeeded in their operation.</p>
<p>Each executable accepts multiple input files. The inputs are parsed in isolation; the resulting ASTs are merged before semantic checks are run.</p>
<p>Errors are written to <code>stderr</code>.</p>
<h3><code>mcc</code></h3>
<p>This is the main compiler executable, sometimes referred to as <em>driver</em>. </p><pre class="fragment">usage: mcc [OPTIONS] file...

The mC compiler. It takes mC input files and produces an executable.

Use '-' as input file to read from stdin.

OPTIONS:
  -h, --help                displays this help message
  -v, --version             displays the version number
  -q, --quiet               suppress error output
  -o, --output &lt;file&gt;       write the output to &lt;file&gt; (defaults to 'a.out')

Environment Variables:
  MCC_BACKEND               override the back-end compiler (defaults to 'gcc' in PATH)
</pre><h3><code>mc_ast_to_dot</code></h3>
<pre class="fragment">usage: mc_ast_to_dot [OPTIONS] file...

Utility for printing an abstract syntax tree in the DOT format. The output
can be visualised using graphviz. Errors are reported on invalid inputs.

Use '-' as input file to read from stdin.

OPTIONS:
  -h, --help                displays this help message
  -o, --output &lt;file&gt;       write the output to &lt;file&gt; (defaults to stdout)
  -f, --function &lt;name&gt;     limit scope to the given function
</pre><h3><code>mc_symbol_table</code></h3>
<pre class="fragment">usage: mc_symbol_table [OPTIONS] file...

Utility for displaying the generated symbol tables. Errors are reported on
invalid inputs.

Use '-' as input file to read from stdin.

OPTIONS:
  -h, --help                displays this help message
  -o, --output &lt;file&gt;       write the output to &lt;file&gt; (defaults to stdout)
  -f, --function &lt;name&gt;     limit scope to the given function
</pre><h3><code>mc_type_check_trace</code></h3>
<pre class="fragment">usage: mc_type_check_trace [OPTIONS] file...

Utility for tracing the type checking process. Errors are reported on
invalid inputs.

Use '-' as input file to read from stdin.

OPTIONS:
  -h, --help                displays this help message
  -o, --output &lt;file&gt;       write the output to &lt;file&gt; (defaults to stdout)
  -f, --function &lt;name&gt;     limit scope to the given function
</pre><h3><code>mc_ir</code></h3>
<pre class="fragment">usage: mc_ir [OPTIONS] file...

Utility for viewing the generated intermediate representation. Errors are
reported on invalid inputs.

Use '-' as input file to read from stdin.

OPTIONS:
  -h, --help                displays this help message
  -o, --output &lt;file&gt;       write the output to &lt;file&gt; (defaults to stdout)
  -f, --function &lt;name&gt;     limit scope to the given function
</pre><h3><code>mc_cfg_to_dot</code></h3>
<pre class="fragment">usage: mc_cfg_to_dot [OPTIONS] file...

Utility for printing a control flow graph in the DOT format. The output
can be visualised using graphviz. Errors are reported on invalid inputs.

Use '-' as input file to read from stdin.

OPTIONS:
  -h, --help                displays this help message
  -o, --output &lt;file&gt;       write the output to &lt;file&gt; (defaults to stdout)
  -f, --function &lt;name&gt;     limit scope to the given function
</pre><h3><code>mc_asm</code></h3>
<pre class="fragment">usage: mc_asm [OPTIONS] file...

Utility for printing the generated assembly code. Errors are reported on
invalid inputs.

Use '-' as input file to read from stdin.

OPTIONS:
  -h, --help                displays this help message
  -o, --output &lt;file&gt;       write the output to &lt;file&gt; (defaults to stdout)
  -f, --function &lt;name&gt;     limit scope to the given function
</pre><h2>Project Structure</h2>
<p>The following directory layout is used. </p><pre class="fragment">mcc/
├── app/                                # Each C file in this directory corresponds to one executable.
│   ├── mc_ast_to_dot.c
│   ├── mcc.c
│   └── …
├── docs/                               # Additional documentation goes here.
│   └── …
├── include/                            # All public headers live here, note the `mcc` subdirectory.
│   └── mcc/
│       ├── ast.h
│       ├── ast_print.h
│       ├── ast_visit.h
│       ├── parser.h
│       └── …
├── src/                                # The actual implementation; may also contain private headers and so on.
│   ├── ast.c
│   ├── ast_print.c
│   ├── ast_visit.c
│   ├── parser.y
│   ├── scanner.l
│   └── …
├── test/
│   ├── integration/                    # Example inputs for integration testing.
│   │   ├── fib/
│   │   │   ├── fib.mc
│   │   │   ├── fib.stdin.txt
│   │   │   └── fib.stdout.txt
│   │   └── …
│   └── unit/                           # Unit tests, typically one file per unit.
│       ├── parser_test.c
│       └── …
├── vendor/                             # Third-party libraries and tools go here.
│   └── …
└── README.md
</pre><p>The README is kept short and clean with the following sections:</p>
<ul>
<li>Prerequisites</li>
<li>Build instructions</li>
<li>Known issues</li>
</ul>
<p><code>src</code> contains the implementation of the library, while <code>include</code> defines its API.</p>
<p>Each application (C file inside <code>app</code>) is linked against the shared library and uses the provided interface. They mainly contain argument parsing and combine the functionality provided by the library to achieve their tasks.</p>
<p>The repository does not contain or track generated files.</p>
<p>Under normal circumstances, all generated files are placed somewhere inside the build directory (i.e. out-of-source build).</p>
<h3>Known Issues</h3>
<p>At any point in time, the README contains a list of unfixed, known issues.</p>
<p>Each entry is kept short and concise and should be justified. More complex issues may reference a dedicated document inside <code>docs</code> providing more details.</p>
<h2>Build Infrastructure</h2>
<p>As build system (generator), use either <a href="http://mesonbuild.com/">Meson</a>, <a href="https://cmake.org/">CMake</a>, or plain Makefiles. Dependencies between source files are modelled correctly to enable a short development cycle.</p>
<p><em>Note:</em> Talk to me if you want to use a different build system.</p>
<h3>Building</h3>
<p>The default build configuration is <em>release</em> (optimisations enabled). Unless Meson or CMake is used, the README documents how to switch to a <em>debug</em> configuration.</p>
<p>Warnings are always enabled: <code>-Wall -Wextra</code> are used at least.</p>
<h3>Testing</h3>
<p>Crucial or complicated logic is tested adequately.</p>
<p>The project infrastructure provides a <em>simple</em> way to run all unit and integration tests. See the getting started code-base for an example (<code>scripts/run_integration_tests</code>).</p>
<p>Similarly, a way to run unit tests using <code>valgrind</code> is provided.</p>
<h3>Coverage</h3>
<p>An HTML coverage report can be obtained following <em>simple</em> instructions inside the README.</p>
<h3>Dependencies</h3>
<p>The <em>prerequisites</em> section of the README enumerates the dependencies. The implementation should not have any dependencies apart from the C (or C++) standard library and a unit testing framework.</p>
<p>The unit testing framework is <em>vendored</em> and automatically used by the build system. See the getting started code-base for an example.</p>
<h2>Coding Guidelines</h2>
<p>Architectural design and readability of your code will be judged.</p>
<ul>
<li>Don't be a git — use <a href="https://git-scm.com/">Git</a>!</li>
<li>Files are UTF-8 encoded and use Unix line-endings (<code>\n</code>).</li>
<li>Files contain <em>one</em> newline at the end.</li>
<li>Lines do not contain trailing whitespaces.</li>
<li>Your code does not trigger warnings, justify them if otherwise.</li>
<li>Do not waste time or space (this includes memory leaks).</li>
<li>Check for leaks using <code>valgrind</code>, especially in error cases.</li>
<li>Keep design and development principles in mind, especially KISS and DRY.</li>
<li>Always state the source of non-original content.<ul>
<li>Use persistent links when possible.</li>
<li>Ideas and inspirations should be referenced too.</li>
</ul>
</li>
</ul>
<blockquote class="doxtable">
<p>Credit where credit is due. </p>
</blockquote>
<h3>C/C++</h3>
<ul>
<li>While not required, it is highly recommended to use a formatting tool, like <a href="https://clang.llvm.org/docs/ClangFormat.html">ClangFormat</a>. A configuration file is provided in the getting started code-base, however, you are free to rule your own.</li>
<li>Lines should not exceed 120 columns.</li>
<li>The nesting depth of control statements should not exceed 4.<ul>
<li>Move inner code to dedicated functions or macros.</li>
<li>Avoid using conditional and loop statements inside <code>case</code>.</li>
</ul>
</li>
<li>Use comments <em>where necessary</em>.<ul>
<li>Code should be readable and tell <em>what</em> is happening.</li>
<li>A comment should tell you <em>why</em> something is happening, or what to look out for.</li>
<li>An overview at the beginning of a module header is welcome.</li>
</ul>
</li>
<li>Use the following order for includes (separated by an empty line):<ul>
<li>Corresponding header (<code>ast.c</code> → <code>ast.h</code>)</li>
<li>System headers</li>
<li>Other library headers</li>
<li>Public headers of the same project</li>
<li>Private headers of the same project</li>
</ul>
</li>
<li>The structure of a source file should be similar to its corresponding header file.<ul>
<li>Separators can be helpful, but they should not distract the reader.</li>
</ul>
</li>
<li>Keep public header files free from implementation details, this also applies to the overview comment.</li>
<li>Use assertions to verify preconditions.</li>
<li>Ensure the correct usage of library functions, remember to always check return codes.</li>
<li>Prefer bound-checking functions, like <code>snprintf</code>, over their non-bound-checking variant.</li>
</ul>
<p>Also, keep the following in mind, taken from <a href="https://www.kernel.org/doc/html/v4.10/process/coding-style.html">Linux Kernel Coding Style</a>:</p>
<blockquote class="doxtable">
<p>Functions should be short and sweet, and do just one thing. They should fit on one or two screenfuls of text (the ISO/ANSI screen size is 80x24, as we all know), and do one thing and do that well.</p>
<p>The maximum length of a function is inversely proportional to the complexity and indentation level of that function. So, if you have a conceptually simple function that is just one long (but simple) case-statement, where you have to do lots of small things for a lot of different cases, it's OK to have a longer function.</p>
<p>However, if you have a complex function, and you suspect that a less-than-gifted first-year high-school student might not even understand what the function is all about, you should adhere to the maximum limits all the more closely. Use helper functions with descriptive names (you can ask the compiler to in-line them if you think it's performance-critical, and it will probably do a better job of it than you would have done).</p>
<p>Another measure of the function is the number of local variables. They shouldn't exceed 5–10, or you’re doing something wrong. Re-think the function, and split it into smaller pieces. A human brain can generally easily keep track of about 7 different things, anything more and it gets confused. You know you’re brilliant, but maybe you'd like to understand what you did 2 weeks from now.</p>
</blockquote>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
