<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MC Compiler: docs/cpp_basics/README.MD Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MC Compiler
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_49e56c817e5e54854c35e136979f97ca.html">docs</a></li><li class="navelem"><a class="el" href="../../dir_967e0eafb5c81fc1bad6831a01c17665.html">cpp_basics</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">README.MD</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d7/d59/docs_2cpp__basics_2_r_e_a_d_m_e_8_m_d.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;http://www.jonathanbeard.io/tutorials/FlexBisonC++&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;---</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;### Notes before getting started</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; To compile the example located on [GitHub](https://github.com/jonathan-beard/simple_wc_example) you&#39;ll need a few things. First, you&#39;ll need the [Flex](http://flex.sourceforge.net/) utility. Some systems come with it pre-installed with developer or build tools, but you&#39;ll need to make sure that it is a relatively recent version (e.g., 2.5.37). One issue that might arise for Apple users is an incompatible version of Flex. The default installed version is 2.5.35 (Apple provided), however the header file that is included won&#39;t work with this example. One solution is changing the example, however that will make it incompatible with any recent version of Flex. A better solution is simply to upgrade Flex to a newer version. For more information on this issue for Apple users, [LMGTFY](http://lmgtfy.com/?q=FlexLexer.h+header+file+on+OS+X). </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;### The Flex Scanner</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; How the Flex scanner itself works is beyond the scope of this tutorial. There are plenty of references on how to get started with a scanner, especially in C. There are lots of other examples out there but I found that most require quite a bit of work to get going and are far from complete. I based the example on some other Flex/Bison examples that create something similar to the Unix word count utility (*wc*). The language I used differs slightly from *wc* in the following respects: words are only alpha characters, numbers are simply counted as characters and I count upper and lower case characters.</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;### The Flex Scanner Code</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;```c</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;%{</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;/* C++ string header, for string ops below */</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;#include &lt;string&gt;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;/* Implementation of yyFlexScanner */ </div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;#include &quot;mc_scanner.hpp&quot;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;#undef  YY_DECL</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;#define YY_DECL int MC::MC_Scanner::yylex( MC::MC_Parser::semantic_type * const lval, MC::MC_Parser::location_type *location )</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;/* using &quot;token&quot; to make the returns for the tokens shorter to type */</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;using token = MC::MC_Parser::token;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;/* define yyterminate as this instead of NULL */</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;#define yyterminate() return( token::END )</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;/* msvc2010 requires that we exclude this header file. */</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;#define YY_NO_UNISTD_H</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;/* update location on matching */</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;#define YY_USER_ACTION loc-&gt;step(); loc-&gt;columns(yyleng);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;%}</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;%option debug</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;%option nodefault</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;%option yyclass=&quot;MC::MC_Scanner&quot;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;%option noyywrap</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;%option c++</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;%%</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;%{          /** Code executed at the beginning of yylex **/</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            yylval = lval;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;%}</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;[a-z]       {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;               return( token::LOWER );</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;[A-Z]       {</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;               return( token::UPPER );</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;[a-zA-Z]+   {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;               /**</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                * Section 10.1.5.1 of the 3.0.2 Bison Manual says the </div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                * following should work:</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                * yylval.build( yytext );</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                * but it doesn&#39;t.</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                * ref: http://goo.gl/KLn0w2</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                */</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;               yylval-&gt;build&lt; std::string &gt;( yytext );</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;               return( token::WORD );</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;\n          {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;               /** Update line number **/</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;               loc-&gt;lines();</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;               return( token::NEWLINE );</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;.           {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;               return( token::CHAR );</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;%%</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;```</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;A brief explanation of the scanner file</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;On line 3 the C++ string header file is included since we use it within this code. The scanner header file (line 6) is included, which we&#39;ll talk about next, extends yyFlexLexer found in FlexLexer.h. This is the scanner class itself. Next you&#39;ll see a using statement included simply to make the namespacing a bit shorter to type when returning tokens. In previous versions of this tutorial I&#39;d added a macro to create actual string objects from the char string yytext. Bison now defines a template function to cast/create the proper objects for you, so this version of the tutorial uses this more modern construct. If you&#39;re interested in the details, see the Bison documenation (direct link). In the past you would manually have to define your own union. Now that is largely done for you based on the token types which is much nicer. On line 7 you&#39;ll want to notice that the yylex function that is defined in the mc\_scanner.hpp header file is declared as a \#define with YY\_DECL. This function signature must match that one (minus the virtual or other class header keywords). This is extremely important, otherwise you will hit this section within the generated code, and get the default yylex() function (discussed in detail later).</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;On line 14 you&#39;ll notice that I&#39;ve defined terminate, I would like it to be a token type instead of NULL so we define it before the code below is read (from the generated file). This way yyterminate() is already defined by the time the compiler reaches this point in the generated code so our version is in the compiled code and not the default one.</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;```c</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;/* No semi-colon after return; correct usage is to write &quot;yyterminate();&quot; -</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; * we don&#39;t want an extra &#39;;&#39; after the &quot;return&quot; because that will cause</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; * some compilers to complain about unreachable statements.</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; */</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;#ifndef yyterminate</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;#define yyterminate() return YY_NULL</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;#endif</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;```</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;Next you&#39;ll see that there are several options selected. Most of these are self explanatory or are explained within the Flex documentation, however the one&#39;s you don&#39;t want to miss are the nodefault, yyclass=, noyywrap and c++ options. The yyclass option indicates what the scanner class is actually called. This is the same class that is imported on line 3.</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;**The Scanner Class Definition**</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;--------------------------------</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;```c</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;ifndef MCSCANNER_HPP</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;define MCSCANNER_HPP 1</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;if ! defined(yyFlexLexerOnce)</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;include &lt;FlexLexer.h&gt;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;endif</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;include &quot;mc_parser.tab.hh&quot;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;include &quot;location.hh&quot;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;namespace MC{</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;class MC_Scanner : public yyFlexLexer{</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;public:</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;MC_Scanner(std::istream *in) : yyFlexLexer(in)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;loc = new MC::MC_Parser::location_type();</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;};</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;//get rid of override virtual function warning</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;using FlexLexer::yylex;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;virtual</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;int yylex( MC::MC_Parser::semantic_type * const lval,</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;MC::MC_Parser::location_type *location );</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;// YY_DECL defined in mc_lexer.l</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;// Method body created by flex in mc_lexer.yy.cc</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;private:</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;/* yyval ptr */</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;MC::MC_Parser::semantic_type yylval = nullptr;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;/ location ptr */</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;MC::MC_Parser::location_type *loc = nullptr;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;};</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;} /* end namespace MC */</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;endif /* END MCSCANNER_HPP */</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;```</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;Line 5 simply includes the FlexLexer.h class that defines yyFlexLexer. We then include the bison generated header file which includes the token definitions. The constructor is relatively straight forward, we simply call the yyFlexLexer constructor then we initialize the private yylval pointer to nullptr. The only function that we need to define in this simple example we have yylex which we defined as YY\_DECL earlier. One thing to make note of is the fact that yylex() is now declared as virtual, and can throw an override error when defining your own function. To get around this, we&#39;ve added a using statement to ensure the compiler knows that we meant to define a new yylex on line 24\. Just to show why we undefined YY\_DECL here&#39;s a code snippet from the generated [lex.yy.cc](http://lex.yy.cc):</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;```c</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;#ifndef YY_DECL</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;#define YY_DECL_IS_OURS 1</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;/* %if-c-only Standard (non-C++) definition */</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;/* %endif */</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;/* %if-c++-only C++ definition */</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;#define YY_DECL int yyFlexLexer::yylex()</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;/* %endif */</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;#endif /* !YY_DECL */</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;```</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;By defining YY\_DECL, we get rid of the native one. That pretty much concludes the scanner portion, on to the parser stuff.</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;The Bison C++ Parser File</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;-------------------------</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;```c</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;%skeleton &quot;lalr1.cc&quot;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;%require  &quot;3.0&quot;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;%debug </div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;%defines </div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;%define api.namespace {MC}</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;%define parser_class_name {MC_Parser}</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;%code requires{</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;   namespace MC {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      class MC_Driver;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      class MC_Scanner;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;// The following definitions is missing when %locations isn&#39;t used</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;# ifndef YY_NULLPTR</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;#  if defined __cplusplus &amp;&amp; 201103L &lt;= __cplusplus</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;#   define YY_NULLPTR nullptr</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;#  else</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;#   define YY_NULLPTR 0</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;#  endif</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;# endif</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;%parse-param { MC_Scanner  &amp;scanner  }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;%parse-param { MC_Driver  &amp;driver  }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;%code{</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   #include &lt;iostream&gt;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   #include &lt;cstdlib&gt;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   #include &lt;fstream&gt;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   </div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   /* include for all driver functions */</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;   #include &quot;mc_driver.hpp&quot;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;#undef yylex</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;#define yylex scanner.yylex</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;%define api.value.type variant</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;%define parse.assert</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;%token               END    0     &quot;end of file&quot;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;%token               UPPER</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;%token               LOWER</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;%token &lt;std::string&gt; WORD</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;%token               NEWLINE</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;%token               CHAR</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;%locations</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;%%</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;list_option : END | list END;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;list</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  : item</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  | list item</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  ;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;item</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  : UPPER   { driver.add_upper(); }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  | LOWER   { driver.add_lower(); }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  | WORD    { driver.add_word( $1 ); }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  | NEWLINE { driver.add_newline(); }</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  | CHAR    { driver.add_char(); }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  ;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;%%</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;void </div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;MC::MC_Parser::error( const location_type &amp;l, const std::string &amp;err_message )</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;{</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;   std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; err_message &lt;&lt; &quot; at &quot; &lt;&lt; l &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;```</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;Exactly how to write a language, and express it such that the parser can parse it is definitely beyond the scope of this tutorial, there are plenty of books on how to do this. Here is just a simple description of how to define the C++ parser. The first line declares that we want to use the lalr1 skeleton file (if you want to learn what types of skeletons are available, the documentation does a fairly good job going through them). We then include the required version of Bison (for this example version 3.0+, however you can download an example that works with version 2.5 through 2.7 here: link). There&#39;s a bit of new syntax which is the reason for the version differentiation. The debug option is set on line 3. The namespace that we want this parser to use is defined on line 5 along with the parser class on line 6 (Note: its usually a good idea to have a unique namespace and a parser name so when you have multiple parsers they can be kept very distinct). On line 8 the classes that are used within the parser are defined, think of this as a forward declaration. Lines 14 through 21 are included because of a bug (perhaps feature) that removes this definition when %locations isn&#39;t used. Lines 25 and 26 are important as they define what will be given to the parser when its instantiated and upon calls to yylex. There&#39;s quite a few more options that can be given to Bison, some of those for version 3.0 are listed here (Bison Docs). Here&#39;s a snippet from the generated parser header to show our parser constructor mc_parser.tab.hh:</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;```c</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    /// Build a parser object.</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    MC_Parser (MC_Scanner  &amp;scanner_yyarg, MC_Driver  &amp;driver_yyarg);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;```</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;Reference to both the passed in driver and scanner are kept as private members of the parser class. Within the code section we have all the rest of the information that our code will need to compile, include the requisite C++ headers, the driver class that we&#39;ll get to shortly. We also define a static yylex function that&#39;ll be called within the bison parse function that takes the parameters that were defined on lines 25-26\. This function will call the scanner&#39;s yylex function, any other behavior need can be defined here. Next we have the simple language which differs from the way the actual wc functions in the manner mentioned in the intro. Last the error function and the static yylex function is defined.</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;The Driver Header File</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;----------------------</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;```c</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;#ifndef __MCDRIVER_HPP__</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;#define __MCDRIVER_HPP__ 1</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;#include &lt;string&gt;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;#include &lt;cstddef&gt;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;#include &lt;istream&gt;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;#include &quot;mc_scanner.hpp&quot;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;#include &quot;mc_parser.tab.hh&quot;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;namespace MC{</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;class MC_Driver{</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;public:</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   MC_Driver() = default;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;   virtual ~MC_Driver();</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   </div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   /** </div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    * parse - parse from a file</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    * @param filename - valid string with input file</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    */</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   void parse( const char *filename );</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   /** </div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    * parse - parse from a c++ input stream</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    * @param is - std::istream&amp;, valid input stream</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    */</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;   void parse( std::istream &amp;iss );</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;   void add_upper();</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;   void add_lower();</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   void add_word( const std::string &amp;word );</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   void add_newline();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;   void add_char();</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;   std::ostream&amp; print(std::ostream &amp;stream);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;private:</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   void parse_helper( std::istream &amp;stream );</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;   std::size_t  chars      = 0;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   std::size_t  words      = 0;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   std::size_t  lines      = 0;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   std::size_t  uppercase  = 0;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   std::size_t  lowercase  = 0;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;   MC::MC_Parser  *parser  = nullptr;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;   MC::MC_Scanner *scanner = nullptr;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   </div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   /** define some pretty colors **/</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   const std::string red   = &quot;\033[1;31m&quot;;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   const std::string blue  = &quot;\033[1;36m&quot;;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;   const std::string norm  = &quot;\033[0m&quot;;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;};</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;} /* end namespace MC */</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;#endif /* END __MCDRIVER_HPP__ */</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;```</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;One thing you&#39;ll notice is that there are two parse functions. One is to take input from a file, the other for input from a C++ stream. The main function defines paths to take input from a pipe and also via file. This is implemented via these parser functions. The cool thing about having a stream input is that you can also use this to parse command line input if you&#39;d like.</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;**The Driver Implementation**</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;-----------------------------</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;```c</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;#include &lt;cctype&gt;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;#include &lt;fstream&gt;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;#include &lt;cassert&gt;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;#include &quot;mc_driver.hpp&quot;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;MC::MC_Driver::~MC_Driver()</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;{</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;   delete(scanner);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   scanner = nullptr;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   delete(parser);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;   parser = nullptr;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;}</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;void </div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;MC::MC_Driver::parse( const char * const filename )</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;{</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;   /**</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    * Remember, if you want to have checks in release mode</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    * then this needs to be an if statement </div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    */</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   assert( filename != nullptr );</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   std::ifstream in_file( filename );</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   if( ! in_file.good() )</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;       exit( EXIT_FAILURE );</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   parse_helper( in_file );</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   return;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;void</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;MC::MC_Driver::parse( std::istream &amp;stream )</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;{</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;   if( ! stream.good()  &amp;&amp; stream.eof() )</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;   {</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;       return;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;   }</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   //else</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;   parse_helper( stream ); </div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;   return;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;}</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;void </div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;MC::MC_Driver::parse_helper( std::istream &amp;stream )</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;{</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   </div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;   delete(scanner);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   try</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;   {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      scanner = new MC::MC_Scanner( &amp;stream );</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;   }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;   catch( std::bad_alloc &amp;ba )</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      std::cerr &lt;&lt; &quot;Failed to allocate scanner: (&quot; &lt;&lt;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;         ba.what() &lt;&lt; &quot;), exiting!!\n&quot;;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      exit( EXIT_FAILURE );</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   }</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   </div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   delete(parser); </div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;   try</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      parser = new MC::MC_Parser( (*scanner) /* scanner */, </div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                  (*this) /* driver */ );</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;   }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   catch( std::bad_alloc &amp;ba )</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;   {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      std::cerr &lt;&lt; &quot;Failed to allocate parser: (&quot; &lt;&lt; </div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;         ba.what() &lt;&lt; &quot;), exiting!!\n&quot;;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      exit( EXIT_FAILURE );</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   const int accept( 0 );</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   if( parser-&gt;parse() != accept )</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;   {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      std::cerr &lt;&lt; &quot;Parse failed!!\n&quot;;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   return;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;}</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;void </div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;MC::MC_Driver::add_upper()</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;{ </div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   uppercase++; </div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   chars++; </div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   words++; </div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;}</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;void </div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;MC::MC_Driver::add_lower()</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;{ </div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   lowercase++; </div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;   chars++; </div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   words++; </div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;}</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;void </div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;MC::MC_Driver::add_word( const std::string &amp;word )</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;{</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   words++; </div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;   chars += word.length();</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;   for(const char &amp;c : word ){</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      if( islower( c ) )</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      { </div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;         lowercase++; </div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      else if ( isupper( c ) ) </div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      { </div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;         uppercase++; </div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      }</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   }</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;void </div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;MC::MC_Driver::add_newline()</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;{ </div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   lines++; </div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   chars++; </div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;void </div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;MC::MC_Driver::add_char()</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;{ </div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   chars++; </div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;}</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;std::ostream&amp; </div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;MC::MC_Driver::print( std::ostream &amp;stream )</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;{</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;   /** NOTE: Colors are defined as class variables w/in MC_Driver **/</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   stream &lt;&lt; red  &lt;&lt; &quot;Results: &quot; &lt;&lt; norm &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   stream &lt;&lt; blue &lt;&lt; &quot;Uppercase: &quot; &lt;&lt; norm &lt;&lt; uppercase &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   stream &lt;&lt; blue &lt;&lt; &quot;Lowercase: &quot; &lt;&lt; norm &lt;&lt; lowercase &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   stream &lt;&lt; blue &lt;&lt; &quot;Lines: &quot; &lt;&lt; norm &lt;&lt; lines &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;   stream &lt;&lt; blue &lt;&lt; &quot;Words: &quot; &lt;&lt; norm &lt;&lt; words &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   stream &lt;&lt; blue &lt;&lt; &quot;Characters: &quot; &lt;&lt; norm &lt;&lt; chars &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   return(stream);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;}</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;```</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;All thats left is to define a main class to instantiate everything and a Makefile to run the compilation from the command line (invoked by typing make in the source code directory). Our main class is perhaps a bit more complex than it has to be, however I wanted to include the stream example and the file example all in one, so there is extra code to parse the two flags I added to make this happen. It should be relatively self explanatory for anyone familiar with parsing the argv array.</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;**The Main Function**</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;```c</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;#include &lt;iostream&gt;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;#include &lt;cstdlib&gt;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;#include &lt;cstring&gt;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;#include &quot;mc_driver.hpp&quot;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;int </div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;main( const int argc, const char **argv )</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;{</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   /** check for the right # of arguments **/</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;   if( argc == 2 )</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   {</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      /** instantiate driver object **/</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      MC::MC_Driver driver;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      /** example for piping input from terminal, i.e., using cat **/ </div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      if( std::strncmp( argv[ 1 ], &quot;-o&quot;, 2 ) == 0 )</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;         driver.parse( std::cin );</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      }</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      /** simple help menu **/</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      else if( std::strncmp( argv[ 1 ], &quot;-h&quot;, 2 ) == 0 )</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;         std::cout &lt;&lt; &quot;use -o for pipe to std::cin\n&quot;;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;         std::cout &lt;&lt; &quot;just give a filename to count from a file\n&quot;;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;         std::cout &lt;&lt; &quot;use -h to get this menu\n&quot;;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;         return( EXIT_SUCCESS );</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      /** example reading input from a file **/</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      else</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;         /** assume file, prod code, use stat to check **/</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;         driver.parse( argv[1] );</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      driver.print( std::cout ) &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;   }</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;   else</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      /** exit with failure condition **/</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      return ( EXIT_FAILURE );</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;   }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;   return( EXIT_SUCCESS );</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;}</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;```</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;**The Makefile**</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;```c</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;CC    ?= clang</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;CXX   ?= clang++</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;EXE = my_wc</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;CDEBUG = -g -Wall</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;CXXDEBUG = -g -Wall</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;CSTD = -std=c99</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;CXXSTD = -std=c++11</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;CFLAGS = -Wno-deprecated-register -O0  $(CDEBUG) $(CSTD) </div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;CXXFLAGS = -Wno-deprecated-register -O0  $(CXXDEBUG) $(CXXSTD)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;CPPOBJ = main mc_driver</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;SOBJ =  parser lexer</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;FILES = $(addsuffix .cpp, $(CPPOBJ))</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;OBJS  = $(addsuffix .o, $(CPPOBJ))</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;CLEANLIST =  $(addsuffix .o, $(OBJ)) $(OBJS) \</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                mc_parser.tab.cc mc_parser.tab.hh \</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                location.hh position.hh \</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;               stack.hh mc_parser.output parser.o \</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                lexer.o mc_lexer.yy.cc $(EXE)\</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;.PHONY: all</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;all: wc</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;wc: $(FILES)</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   $(MAKE) $(SOBJ)</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   $(MAKE) $(OBJS)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;   $(CXX) $(CXXFLAGS) -o $(EXE) $(OBJS) parser.o lexer.o $(LIBS)</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;parser: mc_parser.yy</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   bison -d -v mc_parser.yy</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;   $(CXX) $(CXXFLAGS) -c -o parser.o mc_parser.tab.cc</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;lexer: mc_lexer.l</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;   flex --outfile=mc_lexer.yy.cc  $&lt;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   $(CXX)  $(CXXFLAGS) -c mc_lexer.yy.cc -o lexer.o</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;.PHONY: test</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;test:</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   cd test &amp;&amp; ./test0.pl</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;.PHONY: clean</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;clean:</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   rm -rf $(CLEANLIST)</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;```</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;Be aware that some compilers still use the c++0x flag for standard in lieu or the c++11 flag. If you are not using clang as your compiler you should change the appropriate lines within the Makefile so that make will know which compiler to call. The full code is available for download from my git-hub page here: https://github.com/jonathan-beard/simple_wc_example.git or Zip Download . If you find some errors, feel free to hop on GitHub and correct them!! I&#39;ll update the pieces here accordingly. Thanks to all who have contributed to making this as up to date as possible.</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
